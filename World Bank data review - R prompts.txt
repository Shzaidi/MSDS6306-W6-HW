rm(list=ls()) 
objects()
getwd() # Set your desired work directory for saving workfile and check it by repeating the command 
GDPData<-read.csv("https://d396qusza40orc.cloudfront.net/getdata%2Fdata%2FGDP.csv ", header=T, sep=",", stringsAsFactors=FALSE)
GDPData2 <- GDPData[-c(1:4,195:330), -c(3,6,7:10)]
names(GDPData2)<-c("ID","Ranking","Country", "GDP")
head(GDPData2)
tail(GDPData2)
attach(GDPData2)
dim(GDPData2) # or length (GDP) This gives us the number of countries for which we have GDP data for (eg 190)
EduData<-read.csv("https://d396qusza40orc.cloudfront.net/getdata%2Fdata%2FEDSTATS_Country.csv", header=T, sep=",", stringsAsFactors=FALSE)
names(EduData)<-c("ID","Country","Income_Group", "Region", "Lending_Group", "Other")
dim(EduData) # This gives us the number of countries for which we have EduData data for (eg 234)
# Question 1: Match the data based on the country shortcode. How many of the IDs match?  
#Merging and removing duplicate country names from the Data merged dataset
Data<- merge(GDPData2, EduData, by="ID") 
attach(Data)
dim(Data) # This gives us the number of countries for which we haveboth GDP and EduData data for (eg 189)
#Display and storing answer to first question
answ1 <- length(GDP)
message("Number of countries for which both data type are available is: 189")
# Question 2: Sort the data frame in ascending order by GDP rank. What is the 13th country in the resulting data frame?  
# Ensuring GDP is captured as numeric vector and is not in scientific format in the dataframe (for whatever reason this step might be implemented twice to have effect)
sapply(Data,class) 
typeof(GDP)
Data$GDP <- gsub("\\,","",GDP)
Data2 <-transform (Data, GDP=as.numeric(as.character(GDP)))
typeof(GDP)
# Sorting data frame as requested and displaying and storing answer 2
sort.Data2 <- Data2[order(Data2$GDP), ]
attach(sort.Data2)
sort.Data2[13,3] # Gives the names of the 13th country in the merged list by GDP asc.
answ2 <- sort.Data2[13,3] 
message("The 13th country by GDP (ascending) is: St. Kitts and Nevis")
# Question 3: ÿWhat are the average GDP rankings for the "High income: OECD" and "High income: nonOECD" groups?  
# Ensuring also the Ranking attribute is captured as numeric vector and verifying that no further missing values are for the attributes in scope for the rest of the exercise	
sapply(sort.Data2,class) 
Data3 <-transform (sort.Data2, Ranking=as.numeric(as.character(Ranking)))
sapply(Data3,class)
attach(Data3)
#Displaying and storing answer(s) 3
answ3.1<- with(Data3, mean(Ranking[Income_Group=="High income: OECD"]))
message("The avg Ranking for the ?High income: OECD? countries is: 32.9")
answ3.2<- with(Data3, mean(Ranking[Income_Group=="High income: OECD"]))
message("The avg Ranking for the ?High income: nonOECD? countries is: 91.9")
# Question 4: Plot the GDP for all of the countries. Use ggplot2 to color your plot by Income Group
plot(GDP, bty="l", col="green", pch=19, main="GDP distribution and avrgs.", xlab="Countries (asc. Order)", ylab="GDP in $m")
# And close chart
colour <- c("grey", "yellow","orange","red","black")
col.list <- rep(0, length(Data3$Income_Group))
col.list[Data3$Income_Group=="Low income"] <- 1
col.list[Data3$Income_Group=="Lower middle income"] <-2
col.list[Data3$Income_Group=="Upper middle income"] <- 3
col.list[Data3$Income_Group=="High income: nonOECD"] <- 4
col.list[Data3$Income_Group=="High income: OECD"] <- 5
p <- plot (GDP, pch=19, main="GDP per Income Group", xlab="Countries (asc. Order)", ylab="GDP in $m", col=c(colour[col.list]))
legend(x="topleft", cex=0.7, c(" Low income in Grey ",
 " Lower middle income in Yellow ",
 " Upper middle income in Orange ",
 " High income ? non OECD in Red ",
 " High income ? OECD in Black "))
# And close chart
# Question 5: Cut the GDP ranking into 5 separate quantile groups. Make a table versus Income.Group. How many countries are Lower middle income but among the 38 nations with highest GDP?
# Selecting only relevant attributes
Data4 <-Data3[c(2,6)]
sort.Data4 <- Data4[order(Ranking), ]
#Computing Ranking quintile and grouping by Income_Group
z = quantile(Ranking,c(0.2,0.4,0.6,0.8),na.rm = FALSE,names = FALSE)
z # Checking calculated quantiles
# Install and load data.table package
b<-setDT(sort.Data4)[Ranking<=z[1], quantile:= "1st"][Ranking>=z[1] & Ranking<=z[2], quantile:= "2nd"][Ranking>=z[2] & Ranking<=z[3], quantile:= "3rd"][Ranking>=z[3] & Ranking<=z[4], quantile:= "4th"][Ranking>=z[4], quantile:= "5th"]
sapply(b,class) 
b1 = subset(b, quantile =="1st")
b2 = subset(b1, Income_Group =="Lower middle income")
dim(b2) #  This gives the number of Lower middle income countries in the first Ranking quantile (eg 5)
# Display and storing answer to last question 5
answ5 <- dim(b2) 
message("Number of Lower middle income countries in 1st Ranking quantile is: 5")


