---
title: "Doing Data Science Case Study 1 Unit 6, Week 6"
author: "Najeeb Zaidi"
date: "July 27, 2016"
output: html_document
---
```{r include=FALSE, echo = FALSE}
rm(list = ls()) 
objects()
getwd() 
setwd("C:\\Users\\najee\\Documents\\R\\MSDS6306-W6-HW")

library(ggplot2)
library(stats)
library(dtplyr)
library(data.table)
library(devtools)
library(rmarkdown)
library(tutorial)

tutorial::go_interactive()

```

# World Bank Country Data: Comparative Analysis of GDP vs Education Levels for Select Groups

## Introduction 

This analysis attempts to profile 190 Countries listed in the World Bank dataset, comparing Countries ranked per GDP amounts and the education levels in respective countries. 
In this context, we have explored four (4) elements more specifically.

        1) Data Cleaning & Review of Exclusions
        2) Sorting, Transformations & Rank Ordered Data
        3) GDP Averages & Quantiles for OECD & Non-OECD Income Groups
        4) Basic Visualization of Rank Ordered Data
        5) Conclusion

#### Data Sources:

The data sources used for this presentation are:

    * http://data.worldbank.org/data-catalog/GDP-ranking-table
    ** alternate: https://d396qusza40orc.cloudfront.net/getdata%2Fdata%2FGDP.csv
    
    * http://data.worldbank.org/data-catalog/ed-stats
    ** alternate: https://d396qusza40orc.cloudfront.net/getdata%2Fdata%2FEDSTATS_Country.csv

#### Tools & Libraries / (Reproducible Research Standards):

We have used the RMarkdown and RStudio to create this HTML and to ensure version control and standards of reproducible research. 

The R package version used for this analysis was 3.3.0 and other than the standard libraries, the external R packages employed for this purpose are:

     * library(dtplyr)    : allows the data cleaning, rank ordering & table manipulations;
     * library(stats)     : allows computing averages and quantiles on cleaned data;
     * library(ggplot2)   : allows graphics and basic data visualizations;
     * library(plotrix)   : allows additional graphing capability;
     * library(rmarkdown) : allows source files reproducible;
     
     * DataCamp Light     : https://github.com/datacamp/tutorial
     Allows R code presentation dynamic and interactive for this HTML presentation.



## 1) Reading Raw Data, Cleaning & Review of Exclusions

The data files were read directly from referred web source and matched on the basis of country shortcodes (ID). In this process we found that the GDP data file (sources file 1) contained 190 records while the Education Level data (source file 2) contained 234 records. 


Data Source 1: Procure and read GDP data from target source
```{r echo=FALSE}
GDPData <- read.csv("https://d396qusza40orc.cloudfront.net/getdata%2Fdata%2FGDP.csv ", 
                    header = TRUE, sep = ",", 
                    stringsAsFactors = FALSE)
GDPData2 <- GDPData[-c(1:4,195:330), -c(3,6,7:10)]
names(GDPData2) <- c("ID","Ranking","Country", "GDP")
dim(GDPData2)
str(GDPData2)

```

Data Source 2: Procure and read Education Levels data from target source
```{r echo=FALSE}
EduData <- read.csv("https://d396qusza40orc.cloudfront.net/getdata%2Fdata%2FEDSTATS_Country.csv", header = TRUE, sep = ",", stringsAsFactors = FALSE)
names(EduData) <- c("ID","Country","Income_Group", "Region", "Lending_Group", "Other")
dim(EduData) 
str(EduData)
```

Our analysis of GDP Levels per country vs the Education Levels required that the two files are merged How many of the IDs match? 


Question 1: Match the data based on the country shortcode. How many of the IDs match?  
Merging and removing duplicate country names from the Data merged dataset

```{r }

GDPDataList <- GDPData2[,c(1,3)]
row.names(GDPDataList) <- NULL
B <- GDPDataList[order(GDPDataList$ID),]
EduDataList <- EduData[,c(1,2)]
row.names(EduDataList) <- NULL
A <- EduDataList[order(EduDataList$ID),]
dim(B)
dim(A)
N <- dim(A)[1] 
n <- dim(B)[1] 
# Implementing a double loop by column to check for equal values 
# in two tables and write check results in a new DF table with 
# Country Names and Check columns 
DF <- data.frame(ID = rep("", N), Country = rep("", N), Check = rep("", N),stringsAsFactors = FALSE)
for (i in 1:N)  {
  j <- 1
  while (j <= n)
  {
    if (A[i,1] == B[j,1]) 
    {
      DF[i,1] = A[i,1]
      DF[i,2] = A[i,2]
      DF[i,3] = "yes"
      i <- i + 1
      break
    } else 	
    {
      DF[i,1] = A[i,1]
      DF[i,2] = A[i,2]
      DF[i,3] = "no"
      j <- j + 1
    } 
  }
}
## fix(DF) #And close
Exclusion = subset(DF, Check == "no")
row.names(Exclusion) <- NULL
Exclusion2 <- Exclusion[,c(1,2)]

# ***************************************
EduData2 <- EduData[,c(1:3)]
row.names(EduData2) = NULL
Data <- merge(GDPData2, EduData2, by = "ID") 

dim(Data)[1]
answ1 <- length(Data$ID)
message("Number of countries for which both data type are available is: ", answ1)


```

Question 2: Sort the data frame in ascending order by GDP rank. What is the 13th country in the resulting data frame?  
Ensuring GDP is captured as numeric vector and is not in scientific format in the dataframe (for whatever reason this step might be implemented twice to have effect)

```{r}
sapply(Data, class) 
typeof(Data$GDP)
Data$GDP <- gsub("\\,","", Data$GDP)
GDP <- Data$GDP
Data2 <- transform(Data, GDP = as.numeric(as.character(GDP)))

typeof(Data2$GDP)
# fix(Data2) # To see the data in table format, and close

# Sorting data frame as requested and displaying and storing answer 2
sort.Data2 <- Data2[order(Data2$GDP), ]
# fix(sort.Data2) #To see the data in table format, and close
sort.Data2[13,3] # Gives the names of the 13th country in the merged list by GDP asc.
answ2 <- sort.Data2[13,3] 
message("The 13th country by GDP (ascending) is: ", answ2)

```
Question 3: What are the average GDP rankings for the "High income: OECD" and "High income: nonOECD" groups?  
Ensuring also the Ranking attribute is captured as numeric vector and verifying that no further missing values are for the attributes in scope for the rest of the exercise

```{r}
sapply(sort.Data2, class)
Ranking <- sort.Data2$Ranking
Data3 <- transform(sort.Data2, Ranking = as.numeric(as.character(Ranking)))
sapply(Data3, class)

#fix(Data3) # To see the data, and close 
#Displaying and storing answer(s) 3
answ3.1 <- with(Data3, mean(Ranking[Income_Group == "High income: OECD"]))
message("The avg Ranking for the ???High income: OECD??? countries is: ", round(answ3.1, 2))
answ3.2 <- with(Data3, mean(Ranking[Income_Group == "High income: nonOECD"]))
message("The avg Ranking for the ???High income: nonOECD??? countries is: ", round(answ3.2, 2))


```
Question 4: Plot the GDP for all of the countries. Use ggplot2 to color your plot by Income Group

```{r}
plot(GDP, bty = "l", col = "green", pch = 19, 
     main = "GDP distribution and avrgs.", 
     xlab = "Countries (asc. Order)", 
     ylab = "GDP in $m")

# Visualizing Income Groups by color descriptions
colour <- c("grey", "yellow","orange","red","black")
col.list <- rep(0, length(Data3$Income_Group))
col.list[Data3$Income_Group == "Low income"] <- 1
col.list[Data3$Income_Group == "Lower middle income"] <- 2
col.list[Data3$Income_Group == "Upper middle income"] <- 3
col.list[Data3$Income_Group == "High income: nonOECD"] <- 4
col.list[Data3$Income_Group == "High income: OECD"] <- 5

p <- plot(GDP, pch = 19, main = "GDP per Income Group", 
           xlab = "Countries (asc. Order)", 
           ylab = "GDP in $m", 
           col = c(colour[col.list]))

legend(x = "topleft", cex = 0.7, c(" Low income in Grey ",
                               " Lower middle income in Yellow ",
                               " Upper middle income in Orange ",
                               " High income ? non OECD in Red ",
                               " High income ? OECD in Black "))

```

Question 5: Cut the GDP ranking into 5 separate quantile groups. Make a table versus Income.Group. How many countries are Lower middle income but among the 38 nations with highest GDP?
Selecting only relevant attributes

```{r}
Data4 <- Data3[c(2,6)]
sort.Data4 <- Data4[order(Ranking), ]

# Computing Ranking quintile and grouping by Income_Group
z = quantile(Ranking,c(0.2,0.4,0.6,0.8),na.rm = FALSE,names = FALSE)

# Checking calculated quantiles

b <- setDT(sort.Data4)[Ranking <= z[1], quantile := "1st"][Ranking >= z[1] & Ranking <= z[2], quantile := "2nd"][Ranking >= z[2] & Ranking<=z[3], quantile:= "3rd"][Ranking >= z[3] & Ranking<=z[4], quantile:= "4th"][Ranking >= z[4], quantile:= "5th"]
sapply(b,class) 
b1 = subset(b, quantile == "1st")
b2 = subset(b1, Income_Group == "Lower middle income")

dim(b2)[1] #  This gives the number of Lower middle income countries in the first Ranking quantile (eg 5)
# Display and storing answer to last question 5
answ5 <- dim(b2)[1] 
message("Number of Lower middle income countries in 1st Ranking quantile is: ", answ5)

```
## Summary & Conclusion

We have been able to analyze these countries .....


### Annexes

A. List of countries excluded from original dataset
B. Data cleansing items
C. General description of data trasformation process

